# CPV Premoderation Context

## Зачем делаем
- Разблокировать подключение качественных Telegram-каналов к CPV.
- Снизить риск для блогера: не публиковать рекламный пост "вслепую" и "не в тот момент".
- Уменьшить потери бюджета из-за удаления постов сразу после выхода.

## Подтвержденные вводные
- Главный барьер для части качественных каналов: отсутствие предпросмотра.
- Для крупных рекламодателей критично покрытие "белых списков" каналов.
- Фича важнее для CPV; для CPC не является приоритетом в этой итерации.

## Проблемы, которые должны решаться
1. Блогер не готов к случайному контенту без предупреждения.
2. Блогер может быть готов к рекламе, но не в случайный момент времени.
3. У блогера есть собственный publishing-flow (включая отложенные публикации), в который нужно встраиваться.

## Режимы публикации (целевая модель)
1. `auto`: автоматическая публикация.
2. `auto_with_precheck`: предпросмотр; если не отклонено до дедлайна — пост выходит.
3. `manual_approval`: пост выходит только после явного подтверждения.
4. `manual_posting`: блогер публикует сам (в т.ч. через отложку), бот напоминает при пропуске дедлайна.

## Что должно быть в боте (MVP контур)
- UI режима согласования/отклонения и самопостинга.
- Для отклонения:
  - сообщение с рекламным текстом без ERID;
  - время планируемого выхода;
  - CPM и оценка дохода;
  - действие "отменить/отклонить".
- Для принятия:
  - сообщение с рекламным текстом без ERID;
  - действие "согласовать выход".
- Для ручной публикации:
  - сообщение с рекламным текстом без ERID;
  - после "принять" отправка промаркированного варианта.
- Явные ошибки, если бот заблокирован/не может написать администратору.
- Опция "выбрать другое время" в сообщении предпросмотра через inline-кнопки Telegram:
  - верхний ряд: пагинация по доступным датам;
  - нижний ряд: доступные тайм-слоты выбранной даты.
  - выбор слота должен приводить к явному подтверждению переноса.
- Команда `/mode`:
  - бот отправляет сообщение с 4 кнопками выбора режима;
  - режимы должны соответствовать режимам веб-интерфейса.

## Целевой серверный флоу (зафиксировано для следующей реализации)
- Раз в минуту возникает оффер рекламодателя для канала.
- Бот отправляет оффер блогеру.
- Блогер принимает или отклоняет оффер.
- Цикл повторяется, пока не заполнен недельный лимит публикаций.
- Если рекламодатель отменяет уже согласованный пост, бот отправляет уведомление блогеру, что публикация не состоится.

## Панель планов (веб)
- Нужна панель с видимостью, что и на какое время блогер уже запланировал.
- Для первой итерации панель можно встраивать в блок "Биржевая модель".
- В панели должно быть действие отказа от уже запланированного поста.

## Границы текущего переноса в этот репозиторий
- Переносится только UI-страница настроек и минимальная локальная обвязка для просмотра.
- Не переносится логика бота, TDLib и продовая backend-логика.
- Текущий `cpvdemo/server.js` — это demo/mock-обвязка для UI-прогона, не production-решение.

## Критерий "не раздувать"
- Любое расширение beyond MVP (новые сложные сценарии, дополнительная автоматизация, большие рефакторинги) сначала согласуется отдельно.
