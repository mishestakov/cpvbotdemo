# CPV Demo — Product Flow

## 1. Зачем продукт
Продукт снимает главный барьер блогера в CPV: неготовность к неожиданной рекламе в канале в плане контента и времени выхода.

Цель UX:
- блогер понимает, что и когда может выйти;
- может гибко управлять размещением без потери оффера;
- не теряется в сценариях, даже если у него несколько каналов.

## 2. Роли
- Блогер: подключает канал, выбирает режим публикации, принимает/отклоняет офферы, меняет время.
- Рекламодатель: создаёт оффер (текст, диапазон дат, ставка), выбирает каналы.
- Система (бот): ведёт диалог, показывает доступные действия, отслеживает исход оффера.

## 3. Задача
 - Доработать ПИ бот так, чтобы он реализовывал функционал, который решает эту проблему

## 4. Режимы публикации (что видит блогер)

### 4.1 Автоматически (`auto`) - текущий
- Офферы в личку не приходят.
- В назначенное системой время система пытается опубликовать пост автоматически.
- Если автопубликация невозможна — блогер получает уведомление об ошибке.

Отличие режима: минимальный шум, “тихий” режим.

### 4.2 С предпросмотром (`auto_with_precheck`)
Блогер получает карточку оффера и 3 действия:
- `Подтвердить`
- `Выбрать другое время`
- `Отклонить`

Продуктовый принцип этого режима: публикация по умолчанию должна состояться, если блогер не против.

Исходы:
- Сразу после создания оффер считается подтверждённым по умолчанию (с правом отклонить или перенести до момента публикации).
- Если блогер ничего не нажимает — оффер остаётся подтверждённым и идёт к публикации.
- Напоминания в этом режиме не отправляются, чтобы не снижать вероятность размещения.

### 4.3 Только после подтверждения (`manual_approval`)
Блогер получает карточку оффера и 3 действия:
- `Подтвердить`
- `Выбрать другое время`
- `Отклонить`

Исходы:
- Предусмотрена система напоминаний (п. 5.5)
- Если блогер ничего не нажал до времени выхода — оффер уходит в архив как не размещённый.
- Если блогер нажал `Подтвердить`, то в момент времени выхода система пытается сделать автопост.
- Если автопост не состоялся (техническая ошибка), блогер получает уведомление об ошибке автопубликации.
- Если автопост состоялся — вознаграждение начисляется.

### 4.4 Ручная публикация (`manual_posting`)
Блогер получает карточку оффера и 3 действия:
- `Подтвердить`
- `Выбрать другое время`
- `Отклонить`

Текст уже промаркирован с ERID.

После `Подтвердить`:
- блогер берёт размещение в работу;
- блогер публикует сам;
- если публикация с ERID найдена, пост считается размещенным.

Поведение по дедлайнам и напоминаниям унифицируется с режимом `manual_approval`: до времени выхода блогер должен явно принять решение.

Исходы:
- Если блогер ничего не нажал до времени выхода — оффер уходит в архив как не размещённый.
- Если блогер нажал `Подтвердить`, но публикации с ERID к слоту нет — оффер уходит в архив как не размещённый.
- Если блогер нажал `Подтвердить` и публикация с ERID найдена — после выполнения условия размещенеия начисляется вознаграждение.

## 5. Ветвление логики оффера (продуктово)

## 5.1 Общие развилки
- Рекламодатель отменил оффер -> блогер получает сообщение “публикация не состоится”.
- Блогер отменил уже активный оффер -> оффер отменяется блогером.
- Блогер выбрал другое время -> оффер остаётся активным, меняется слот.

### 5.2 Развилка “Выбрать другое время”
При выборе времени:
1. Верхний ряд — переключение дат (страницы по дням).
2. Нижние ряды — доступные слоты выбранной даты.
3. `Назад` возвращает в карточку оффера без отмены.

Ожидаемый UX-эффект: перенос времени — штатное действие, а не “ошибка/отказ”.

### 5.3 Развилка ручного режима после времени публикации
Если блогер в ручном режиме не разместил пост в первый слот:
- оффер не должен “мгновенно умирать”, пока окно размещения ещё открыто;
- бот отправляет напоминание и предлагает продолжить работу по офферу (подтвердить / выбрать новый слот / отклонить);
- после исчерпания окна или отсутствия доступных слотов — архив.

### 5.5 Дедлайны и напоминания
- Базовый дедлайн принятия решения: `1 рабочий день`, но не позже времени публикации.
- Для срочных кампаний (когда слот ближе, чем 1 рабочий день) дедлайн автоматически сжимается до времени публикации.

Правила по режимам:
- `auto_with_precheck`: напоминания не отправляются.
- `manual_approval`: максимум 2 напоминания.
  - Напоминание 1: в момент дедлайна решения, если решения нет.
  - Напоминание 2: последнее предупреждение перед временем публикации, если решения всё ещё нет.
- `manual_posting`: максимум 2 напоминания.
  - Напоминание 1: в момент дедлайна решения, если блогер не подтвердил/не отклонил/не перенёс.
  - Напоминание 2: последнее предупреждение перед временем публикации, если решения всё ещё нет.

## 6. Мультиканальность (важно)
Если у блогера несколько каналов:
- `/mode` и `/pause` сначала показывают выбор канала;
- в интерфейсе видно статусы по каналам;
- действия применяются к выбранному каналу.

Если канал один:
- шаг выбора канала пропускается.

## 7. Пауза автопубликаций
Пауза — это аварийный стоп на 24 часа для режимов автопубликации 4.1 и 4.2.

Принципы UX:
- не прятать возможность паузы, но и не должно быть так что блогер мог случайно поставить слишком долгую паузу;
- после включения паузы бот сразу пишет до какого момента пауза активна;
- в этом же сообщении есть кнопка-действие “Возобновить”; 
- по окончании паузы бот сообщает, что публикации снова активны.

## 8. Сообщения: продуктовые требования к текстам
Тексты должны:
- говорить, что произойдёт дальше (следующий шаг);
- не требовать “догадаться” о втором обязательном действии;
- явно указывать канал, когда это важно;
- избегать канцелярита.

Критичные точки:
- ручной режим после получения оффера (обязательность шага `Подтвердить`);
- автоархив (почему оффер завершён);
- отмена рекламодателем;
- автопубликация: ошибка/успех.
